<update_mode>
  <instruction>
    Review the existing Better-Auth code and make the following improvements without rewriting the file from scratch.
    Maintain the existing function structure, naming, and CLI UX while extending capabilities and preserving 300-line constraint.
    Integrate all specifications below into the existing implementation, intelligently inserting or modifying code where necessary.
  </instruction>
  <context>Better-Auth is a CLI tool for refining AI prompts and formatting them for specific models.</context>
  <changes>
    <item>Add model-format compatibility mapping for all major providers.</item>
    <item>Add plugin system hooks (no imports from plugins, only dynamic loading).</item>
    <item>Ensure graceful error handling for all user inputs.</item>
    <item>Maintain color-coded, elegant terminal output and no crash behavior.</item>
  </changes>
  <reference>
    <existing_file>better_auth.py</existing_file>
  </reference>
  <project name="Better-Auth" goal="Generate a single-file CLI app with plugin scope">
  <meta>
    <description>
      A CLI-based text processing tool that refines and formats user prompts for different LLMs,
      ensuring perfect structure, best-suited syntax (JSON/XML/YAML/Markdown), and error-proof design.
    </description>
    <constraints>
      <constraint>Must not exceed 300 lines of code.</constraint>
      <constraint>Single-file implementation, no multi-file imports.</constraint>
      <constraint>Must never crash — handle all invalid or empty inputs gracefully.</constraint>
      <constraint>Implement plugin hooks but do not import external plugins directly.</constraint>
      <constraint>Show colored output, elegant CLI experience, and clear loading state.</constraint>
    </constraints>
    <language>Python 3.x</language>
    <dependencies>rich, inquirer, json, yaml, xml.etree.ElementTree, re</dependencies>
  </meta>

  <user_flow>
    <step>Show a stylized welcome banner.</step>
    <step>Ask user for their raw prompt text.</step>
    <step>Ask for LLM provider (OpenAI, Anthropic, Google, DeepSeek, Alibaba, X).</step>
    <step>Ask for specific model from that provider using arrow keys.</step>
    <step>Show chosen format type (based on mapping table below) and a loading animation.</step>
    <step>Display the refined prompt in syntax-highlighted, formatted output.</step>
  </user_flow>

  <internal_logic>
    <modules>
      <module name="format_selector">Selects the format (XML/JSON/YAML/Markdown) based on model name.</module>
      <module name="prompt_refiner">Uses regex and heuristics to structure and sanitize the user input prompt.</module>
      <module name="plugin_hook">
        <description>
          Generic placeholder for future plugin calls (e.g., prompt refiner via LangChain,
          LLM call via OpenRouter, syntax linter, or auto-response generator).
        </description>
        <note>Plugins are external and not imported here to meet 300-line rule.</note>
      </module>
    </modules>
  </internal_logic>

  <model_format_matrix>
    <provider name="OpenAI">
      <model name="GPT-4o">JSON</model>
      <model name="GPT-4 Turbo">JSON</model>
      <model name="GPT-3.5 Turbo">YAML</model>
      <model name="GPT-4-mini">JSON</model>
    </provider>
    <provider name="Anthropic">
      <model name="Claude 3.5 Sonnet">XML</model>
      <model name="Claude 3.5 Haiku">XML</model>
      <model name="Claude 3 Opus">YAML</model>
      <model name="Claude Instant">XML</model>
    </provider>
    <provider name="Google">
      <model name="Gemini 1.5 Pro">YAML</model>
      <model name="Gemini 1.5 Flash">JSON</model>
      <model name="Gemini 2.0 Experimental">JSON</model>
    </provider>
    <provider name="DeepSeek">
      <model name="DeepSeek Chat">YAML</model>
      <model name="DeepSeek Coder">JSON</model>
      <model name="DeepSeek R1">YAML</model>
    </provider>
    <provider name="Alibaba">
      <model name="Qwen 2.5">JSON</model>
      <model name="Qwen Max">YAML</model>
      <model name="Qwen Plus">XML</model>
    </provider>
    <provider name="X">
      <model name="Grok 3">YAML</model>
      <model name="Grok 2">JSON</model>
      <model name="Grok Beta">YAML</model>
    </provider>
  </model_format_matrix>

  <plugin_system>
    <note>Each plugin is an external callable script following the Plugin Interface Spec below.</note>
    <interface>
      <function name="process_prompt(input_text, metadata)" returns="dict">
        <description>Process or enhance user prompt and return structured response.</description>
      </function>
    </interface>
    <examples>
      <plugin name="PromptRefiner" desc="Uses LangChain AI to optimize user intent."/>
      <plugin name="LLMDirect" desc="Uses OpenRouter API to test response quality."/>
      <plugin name="PromptLinter" desc="Detects ambiguity or length issues in prompts."/>
    </examples>
  </plugin_system>

  <output>
    <format>Color-coded CLI with refined prompt clearly structured.</format>
    <example_output>
      <code>
        ┌───────────────────────────────────────────────┐
        │ Model: Claude 3.5 Sonnet (XML Format)         │
        │ Conversion: YAML → XML                        │
        │ --------------------------------------------- │
        │ <prompt>                                      │
        │   <context>...</context>                      │
        │   <instruction>...</instruction>               │
        │ </prompt>                                     │
        └───────────────────────────────────────────────┘
      </code>
    </example_output>
  </output>
</project>

  <blueprint>
    ... (Paste the previous project XML block here)
  </blueprint>
</update_mode>
