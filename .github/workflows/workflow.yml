name: Publish Python Package

on:
  push:
    tags:
      - "v*"  # Runs on any tag starting with 'v', e.g. v1.0.0
  workflow_dispatch:  # Manual trigger option

permissions:
  contents: read
  id-token: write  # Needed for trusted publishing (PyPI)

jobs:
  build-and-publish:
    name: Build and Publish to PyPI
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip build twine

      - name: Lint (optional, good practice)
        run: |
          python -m pip install flake8
          flake8 --max-line-length=100 . || true  # Don't fail build on lint warnings

      - name: Run tests (optional, skip if no tests yet)
        run: |
          echo "No tests yet - skipping"  # Replace this with pytest later

      - name: Build distribution
        run: |
          python -m build

      # --- OPTION 1: Trusted Publishing (recommended) ---
      # Requires PyPI project to enable "Trusted Publisher" for GitHub Actions.
      - name: Publish to PyPI (Trusted Publishing)
        uses: pypa/gh-action-pypi-publish@release/v1
        with:
          skip-existing: true

      # --- OPTION 2: Manual Token (uncomment if not using Trusted Publishing) ---
      # - name: Publish to PyPI via Token
      #   uses: pypa/gh-action-pypi-publish@release/v1
      #   with:
      #     user: __token__
      #     password: ${{ secrets.PYPI_API_TOKEN }}
      #     skip-existing: true
